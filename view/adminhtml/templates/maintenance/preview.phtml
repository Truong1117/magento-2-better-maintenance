<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category  Mageplaza
 * @package   Mageplaza_BetterMaintenance
 * @copyright Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license   https://www.mageplaza.com/LICENSE.txt
 */
?>
<?php $data = $block->getFormData(); ?>

<!--Multiple Image Background-->
<?php if ($data['[maintenance_background]'] === 'multiple_images') : ?>
    <?php $listImagesUrl = implode(',', $block->getMultipleImagesUrl('maintenance_background_multi_image')); ?>
    <style>
        .mpbettermaintenance-maintenance-preview {
            background-repeat: no-repeat;
            background-size: cover;
            transition-delay: 2s;
        }
    </style>
    <script>
        require([
            'jquery'
        ], function ($) {
            var images    = '<?= /* @noEscape */ $listImagesUrl ?>';
            images        = images.split(',');
            var nextImage = 0;
            doSlideShow();

            function doSlideShow () {
                if (nextImage >= images.length) {
                    nextImage = 0;
                }
                $('.mpbettermaintenance-maintenance-preview')
                .fadeIn('slow', function () {
                    setTimeout(doSlideShow, 5000);
                }).css('background-image', 'url("' + images[nextImage++] + '")');
            }
        });
    </script>
<?php endif; ?>

<!--Single Image Background-->
<?php if ($data['[maintenance_background]'] === 'image'
    && $block->getImageUrl($data['[maintenance_background_image]'])) : ?>
    <style>
        .mpbettermaintenance-maintenance-preview {
            background-image: url("<?= /* @noEscape */ $block->getImageUrl($data['[maintenance_background_image]']) ?>");
            background-repeat: no-repeat;
            background-size: cover;
        }
    </style>
<?php endif; ?>

<!--Video Background-->
<?php if ($data['[maintenance_background]'] === 'video'
    && $block->getVideoUrl($data['[maintenance_background_video]'])) : ?>
    <video autoplay muted loop id="mpbm-video">
        <source src="<?= /* @noEscape */
        $block->getVideoUrl($data['[maintenance_background_video]']) ?>"
                type="video/mp4">
    </video>
<?php endif; ?>

<div id="mpbm-<?=  /* @noEscape */ $block->getPageLayout('[maintenance_layout]') ?>-column" class="mpbm-preview-wrapper">
    <?php if (!empty($data['[maintenance_logo]'])) : ?>
        <div id="mpbm-logo">
            <img src="<?= /* @noEscape */
            $block->getLogo($data['[maintenance_logo]']) ?>"
                 alt="<?= /* @noEscape */ __('Logo') ?>" width="100">
        </div>
    <?php endif; ?>

    <!--    Page Title Area-->
    <div id="mpbm-page-title">
        <h1 class="mpbm-text" style="margin-bottom: 0"><?= /* @noEscape */
            $block->getPageTitle() ?></h1>
    </div>

    <!--    Page Description Area-->
    <div id="mpbm-page-description">
        <h3 class="mpbm-text"><?= /* @noEscape */
            $block->getPageDes() ?></h3>
    </div>

    <!--    Clock area-->
    <?php if (array_key_exists('[clock_number_color]', $data) && $data['[clock_enabled]']) : ?>
        <div id="mpbm-clock">
            <?= /* @noEscape */
            $block->getClockBlock() ?>
        </div>
    <?php endif; ?>

    <!--    Progress Area-->
    <?php if (array_key_exists('[maintenance_progress_value]', $data) && $data['[maintenance_progress_enabled]']) : ?>
        <div id="mpbm-progress-bar">
            <div class="row">
                <div class="mp-md-6">
                    <div class="progress mp-md-3">
                        <div class="progress-bar" role="progressbar"
                             aria-valuenow="<?= /* @noEscape */ $block->getProgressValue() ?>"
                             aria-valuemin="0"
                             aria-valuemax="100">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <?php endif; ?>

    <!--    Subscribe area-->
    <?php if (array_key_exists('[subscribe_label]', $data) && $block->getSubscribeType() !== 'none') : ?>
        <?php $subscribeLabel = $data['[subscribe_label]'] ?>
        <?php $subscribeLabelColor = $data['[subscribe_label_color]'] ?>
        <?php if ($block->getSubscribeType() === 'email_form') : ?>
            <div id="mpbm-subscribe">
                <?php if ($subscribeLabel) : ?>
                    <h4 style="color: <?= /* @noEscape */ $subscribeLabelColor ?>"><?= /* @noEscape */
                        $subscribeLabel ?></h4>
                <?php endif; ?>
                <?= /* @noEscape */
                $block->getSubscribeBlock() ?>
            </div>
        <?php elseif ($block->getSubscribeType() === 'register_form') : ?>
            <div id="mpbm-register">
                <?php if ($subscribeLabel) : ?>
                    <h4 style="color: <?= /* @noEscape */ $subscribeLabelColor ?>"><?= /* @noEscape */
                        $subscribeLabel ?></h4>
                <?php endif; ?>
                <?= /* @noEscape */
                $block->getRegisterBlock() ?>
            </div>
        <?php endif; ?>
    <?php endif; ?>

    <!--    Social area-->
    <?php if ($data['[social_enabled]']) : ?>
        <div id="mpbm-social-contact">
            <div id="mpbm-social-label" style="display: inline-block">
                <p><?= /* @noEscape */
                    $data['[social_label]'] ?></p>
            </div>
            <?php foreach ($block->getSocialList() as $value) : ?>
                <?php if ($value['link']) : ?>
                    <div class="mpbm-social-box" style="display: inline-block; vertical-align: middle">
                        <a href="<?= /* @noEscape */
                        $value['link'] ?>" target="_blank">
                            <img src="<?= /* @noEscape */
                            $value['img'] ?>" alt="<?= /* @noEscape */ __('Social Logo') ?>" width="20">
                        </a>
                    </div>
                <?php endif; ?>
            <?php endforeach; ?>
        </div>
    <?php endif; ?>

    <?php if ($block->getBlockCms()) : ?>
        <div id="mpbm-footer-block">
            <?= /* @noEscape */
            $block->getBlockCms() ?>
        </div>
    <?php endif; ?>
</div>

<style>
    .mpbm-text {
        color: <?= /* @noEscape */ $data['[maintenance_color]'] ?>;
    }

    #mpbm-social-label {
        color: <?= /* @noEscape */ $data['[social_label_color]'] ?>;
    }

    <?php if (array_key_exists('[clock_number_color]', $data) && $data['[clock_template]'] === 'stack') : ?>
    .stack-txt1 {
        background: <?= /* @noEscape */ $data['[clock_inner_color]'] ?>;
    }
    <?php endif; ?>

    <?php if (array_key_exists('[maintenance_progress_value]', $data) && $data['[maintenance_progress_enabled]']) : ?>
    .progress-bar {
        height: 43px;
        font-size: 100%;
        font-weight: bold;
        border-radius: 50px;
        line-height: 45px;
        color: <?= /* @noEscape */ $data['[maintenance_progress_label_color]'] ?>;
        background-color: <?= /* @noEscape */ $data['[maintenance_progress_bar_color]'] ?>;
        width: 0;
    }
    <?php endif; ?>
</style>

<?php if (array_key_exists('[subscribe_label]', $data) && $block->getSubscribeType() !== 'none') : ?>
    <script>
        require([
            'jquery'
        ], function ($) {
            var subBtn = $('.action.primary span');
            subBtn.text("<?= /* @noEscape */ $data['[button_label]'] ?>")
            .css("color", "<?= /* @noEscape */ $data['[button_label_color]'] ?>");
            $('.action.primary').css("background", "<?= /* @noEscape */ $data['[button_background_color]'] ?>");
        });
    </script>
<?php endif; ?>

<script type="text/x-magento-init">
    {
        ".mpbm-preview-wrapper": {
            "maintenancePreview": {
            <?php if (array_key_exists('[maintenance_progress_value]', $data) && $data['[maintenance_progress_enabled]']) : ?>
                "progressLabel": "<?= /* @noEscape */ $data['[maintenance_progress_label]'] ?>"
            <?php endif; ?>
            }
        }
    }
</script>